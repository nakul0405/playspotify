<!DOCTYPE html>
<html>
<head>
  <title>Logging in...</title>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const cookie = document.cookie.split("; ").find(row => row.startsWith("sp_dc="));
      if (!cookie) {
        document.body.innerHTML = "❌ Could not find your sp_dc cookie. Please open this link in a browser where you're logged into Spotify.";
        return;
      }

      const sp_dc = cookie.split("=")[1];

      fetch("/set_spdc", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          user_id: "{{ user_id }}",
          sp_dc: sp_dc
        })
      })
      .then(res => res.text())
      .then(data => {
        document.body.innerHTML = data;
      })
      .catch(err => {
        document.body.innerHTML = "❌ Something went wrong while saving your cookie.";
      });
    });
  </script>
</head>
<body>
  Logging you in...
</body>
</html>
